# Web-client

**Веб-клиент позволяет взаимодействовать с приложением через браузер. Cогласно сценарию его работа заключается в следующем:**

<br>

Пользователь может находится в одном из состояний:
Неизвестный --(обращение к сервису)--> Анонимный --(вход)--> Авторизованный --(выход)--> Неизвестный.

## Неизвестный пользователь
1. Запрос к веб-клиенту: Пользователь открывает браузер и вводит URL веб-клиента.
2. Обработка запроса через Nginx: Браузер отправляет запрос на компонент Nginx, который перенаправляет его к рабочей копии веб-клиента.
3. Проверка сессии: Веб-клиент делает запрос к Redis с использованием токена сессии (если он есть). Если токена нет, считается, что пользователь неизвестен.
4. Отображение страницы авторизации: Если URL равен /, пользователю предлагается авторизоваться через GitHub, Яндекс ID или с помощью кода. Если URL /login без параметров, происходит редирект на главную страницу.
5. Авторизация: Если URL /login с параметром type, веб-клиент генерирует новый токен сессии и токен входа, сохраняет их в Redis и отправляет запрос к модулю авторизации.

## Анонимный пользователь
1. Запрос с токеном: Пользователь снова открывает веб-клиент. Браузер отправляет запрос с куками, содержащими токен сессии.
2. Проверка наличия токена: Веб-клиент получает информацию из Redis, подтверждая, что токен сессии действителен.
3. Обработка авторизации: Если URL /login с параметром type, генерируется новый токен входа. Если URL /login без параметров, веб-клиент отправляет токен входа на проверку в модуль авторизации.
4. Результаты проверки: В зависимости от ответа модуля авторизации, веб-клиент либо перенаправляет пользователя обратно на главную страницу, либо обновляет статус на Авторизованный.

## Авторизованный пользователь
1. Запрос к веб-клиенту: Авторизованный пользователь открывает веб-клиент и отправляет запрос с токеном доступа.
2. Проверка токена: Веб-клиент обращается к Redis для получения информации о пользователе.
3. Отображение личного кабинета: Если URL равен /, веб-клиент отображает страницу личного кабинета с информацией о пользователе.
4. Выход из системы: Если пользователь запрашивает /logout, токен сессии удаляется из Redis, и пользователь переводится в статус Неизвестный.
5. Обработка других действий: При запросах к другим URL, веб-клиент отправляет запросы к Главному модулю с токеном доступа. В зависимости от прав доступа пользователя выполняется соответствующее действие или возвращается ошибка (403 или 401).

## Обновление токенов
1. Проверка токена доступа: Если токен доступа устарел, веб-клиент запрашивает новый токен обновления у модуля авторизации.
2. Обработка обновления: Если токен обновления действителен, создаются новые JWT токены, которые сохраняются в Redis. Веб-клиент повторно отправляет запрос, используя новые токены.
<br>

## Общая схема работы модуля
![Схема работы модуля](https://github.com/yakubova6/Tester/blob/main/module_web/src/assets/images/Work-scheme.png?raw=true)
